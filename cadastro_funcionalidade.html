<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Funcionalidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Seção de Estilos Customizados */
        .imagem-preview {
            font-size: 0.875rem;
            /* Equivalente a text-sm no Tailwind */
            color: #6b7280;
            /* Equivalente a text-gray-500 no Tailwind */
            margin-top: 0.25rem;
            /* Equivalente a mt-1 no Tailwind */
            display: flex;
            /* Adicionado para alinhar o texto e o botão */
            align-items: center;
            /* Adicionado para alinhar o texto e o botão */
            gap: 0.5rem;
            /* Espaçamento entre o texto e o botão */
        }

        .imagem-preview strong {
            font-weight: 600;
            /* font-semibold */
        }

        .imagem-preview button {
            color: #DC2626;
            /* Cor de perigo para o botão de remover */
            transition: color 0.2s ease;
            font-size: 0.875rem;
            line-height: 1;
            /* Ajusta o alinhamento vertical do texto */
        }

        .imagem-preview button:hover {
            color: #B91C1C;
            /* Hover do botão de perigo */
        }

        /* Estilo para o dropdown de ações */
        #actionsDropdown {
            position: absolute;
            z-index: 1000;
            /* Garante que o dropdown fique acima de outros elementos */
            min-width: 150px;
            /* Adicione uma largura mínima para evitar que ele seja muito estreito */
            box-sizing: border-box;
            /* Garante que padding e border sejam incluídos na largura */
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <header class="bg-[#0D2B45] text-white p-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                class="w-7 h-7 text-[#32C766] mr-2">
                <path fill-rule="evenodd"
                    d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"
                    clip-rule="evenodd" />
            </svg>
            <span class="text-xl font-bold">testcaseAI</span>
        </div>
        <div class="flex items-center space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 0 12 21.75c-2.676 0-5.216-.584-7.5-1.632Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.17.992c.07.4-.108.803-.472 1.068L15.7 7.5c-.347.24-.555.626-.54 1.03l.02.246c.01.29.157.564.407.743l1.192.857c.414.295.667.817.625 1.356l-.088 1.302c-.04.53-.466.96-.995 1.077l-.966.233c-.4.096-.75.32-.977.658L12 18.88c-.227.338-.577.562-.977.658l-.966-.233c-.529-.117-.955-.546-.995-1.076l-.088-1.302c-.042-.539.21-1.061.625-1.356l1.192-.857c.25-.179.397-.453.407-.743l.02-.246c.015-.403-.153-.789-.5-1.03l-2.07-1.5c-.364-.265-.542-.668-.472-1.068l.17-.992Zm.974 6.84a2 2 0 1 0 2.21-3.328 2 0 0 0-2.21 3.328Z" />
            </svg>
            <button id="logoutButton"
                class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-md text-sm ml-4">Sair</button>
        </div>
    </header>

    <div class="bg-[#0D2B45] text-white p-2 flex justify-start items-center space-x-4 px-4 shadow-sm">
        <button class="bg-[#154a70] px-4 py-2 rounded-md font-semibold">Casos de teste</button>
        <button
            class="bg-transparent hover:bg-[#154a70] px-4 py-2 rounded-md font-medium text-gray-300 hover:text-white">Área
            de trabalho</button>
        <button
            class="bg-transparent hover:bg-[#154a70] px-4 py-2 rounded-md font-medium text-gray-300 hover:text-white">Testes
            em execução</button>
    </div>

    <div class="p-6 flex-grow">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Funcionalidades</h2>
            <button title="Nova Funcionalidade" onclick="UI.abrirModalCadastro()"
                class="bg-[#32C766] hover:bg-[#2dae5a] text-white font-bold p-2 rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
            </button>
        </div>

        <h3 class="text-lg font-semibold mb-2">Lista de Casos de teste</h3>

        <div class="w-full bg-white shadow-md rounded-md overflow-hidden">
            <table class="w-full border-collapse">
                <thead class="bg-[#0D2B45] text-white">
                    <tr>
                        <th class="p-3 text-center w-8">
                            <input type="checkbox" id="selectAllCheckbox" class="h-4 w-4 text-[#0D2B45]">
                        </th>
                        <th class="p-3 text-left">Projeto</th>
                        <th class="p-3 text-left">Funcionalidade</th>
                        <th class="p-3 text-left">Prioridade</th>
                        <th class="p-3 text-left">Relator</th>
                        <th class="p-3 text-center">Ações</th>
                    </tr>
                </thead>
                <tbody id="tabela-funcionalidades" class="divide-y divide-gray-200">
                </tbody>
            </table>
        </div>
    </div>

    <div id="actionsDropdown" class="bg-white border border-gray-200 rounded-md shadow-lg hidden">
    </div>

    <div id="modal-cadastro" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center p-4">
        <div class="bg-white p-6 rounded-md shadow-lg w-full max-w-lg">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Nova Funcionalidade</h2>
            <form id="formFuncionalidade" class="space-y-4">
                <input type="hidden" name="id">
                <input type="hidden" name="imagem_existente">
                <div>
                    <label for="nome" class="block text-gray-700 text-sm font-bold mb-2">Funcionalidade:</label>
                    <input id="nome"
                        class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-[#0D2B45] focus:ring-2 focus:ring-[#0D2B45]/20"
                        placeholder="Nome da funcionalidade" name="nome" required>
                </div>
                <div>
                    <label for="relator" class="block text-gray-700 text-sm font-bold mb-2">Relator:</label>
                    <input id="relator"
                        class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-[#0D2B45] focus:ring-2 focus:ring-[#0D2B45]/20"
                        placeholder="Nome do relator" name="relator" required>
                </div>
                <div>
                    <label for="prioridade" class="block text-gray-700 text-sm font-bold mb-2">Prioridade:</label>
                    <select id="prioridade"
                        class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-[#0D2B45] focus:ring-2 focus:ring-[#0D2B45]/20"
                        name="prioridade" required>
                        <option value="Alta">Alta</option>
                        <option value="Média">Média</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                </div>
                <div>
                    <label for="descricao" class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                    <textarea id="descricao"
                        class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-[#0D2B45] focus:ring-2 focus:ring-[#0D2B45]/20"
                        placeholder="Descrição detalhada" name="descricao" rows="3"></textarea>
                </div>
                <div>
                    <label for="imagem" class="block text-gray-700 text-sm font-bold mb-2">Anexo:</label>
                    <input type="file" class="w-full" name="imagem" id="imagem">
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="UI.fecharModalCadastro()"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md">Cancelar</button>
                    <button type="submit"
                        class="bg-[#32C766] hover:bg-[#2dae5a] text-white font-bold py-2 px-4 rounded-md">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="bg-gray-100 text-gray-600 text-center p-6 mt-auto border-t border-gray-200">
        &copy; 2023 testcaseAI - Todos os direitos reservados.
    </footer>

    <script>
        // Função para verificar a autenticação ao carregar a página
        function checkAuthentication() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                // Redireciona para a página de login se não houver token
                window.location.href = 'index.html';
                return false;
            }
            return true;
        }

        // Adiciona um listener para o botão de sair
        document.getElementById('logoutButton').addEventListener('click', function () {
            localStorage.removeItem('access_token');
            localStorage.removeItem('token_type');
            window.location.href = 'index.html';
        });

        // Objeto para gerenciar elementos da UI
        const UI = {
            modalCadastro: document.getElementById('modal-cadastro'),
            tabela: document.getElementById('tabela-funcionalidades'),
            formFuncionalidade: document.getElementById('formFuncionalidade'),
            modalTitle: document.querySelector('#modal-cadastro h2'),
            salvarButton: document.querySelector('#formFuncionalidade button[type="submit"]'),
            idFuncionalidadeEdicaoInput: document.getElementById('formFuncionalidade').querySelector('[name="id"]'),
            actionsDropdown: document.getElementById('actionsDropdown'),
            currentActionButton: null,
            selectAllCheckbox: document.getElementById('selectAllCheckbox'),

            // Métodos para controle de modais e dropdowns
            abrirModalCadastro: function () {
                this.modalTitle.textContent = 'Nova Funcionalidade';
                this.salvarButton.textContent = 'Salvar';
                this.formFuncionalidade.reset();
                this.idFuncionalidadeEdicaoInput.value = '';
                const imagemExistenteInput = this.formFuncionalidade.querySelector('[name="imagem_existente"]');
                if (imagemExistenteInput) {
                    imagemExistenteInput.value = ''; // Limpa o valor para nova funcionalidade
                }
                const imagemPreview = this.formFuncionalidade.querySelector('.imagem-preview');
                if (imagemPreview) {
                    imagemPreview.remove();
                }
                this.modalCadastro.classList.remove('hidden');
            },

            fecharModalCadastro: function () {
                this.modalCadastro.classList.add('hidden');
            },

            abrirModalEdicao: function (funcionalidade) {
                this.modalTitle.textContent = 'Editar Funcionalidade';
                this.salvarButton.textContent = 'Atualizar';
                this.formFuncionalidade.reset();

                this.formFuncionalidade.querySelector('[name="nome"]').value = funcionalidade.nome;
                this.formFuncionalidade.querySelector('[name="relator"]').value = funcionalidade.relator;
                this.formFuncionalidade.querySelector('[name="prioridade"]').value = funcionalidade.prioridade;
                this.formFuncionalidade.querySelector('[name="descricao"]').value = funcionalidade.descricao || '';
                this.idFuncionalidadeEdicaoInput.value = funcionalidade.id || '';

                let imagemInput = this.formFuncionalidade.querySelector('[name="imagem"]');
                let imagemExistenteInput = this.formFuncionalidade.querySelector('[name="imagem_existente"]');
                let imagemPreview = this.formFuncionalidade.querySelector('.imagem-preview');

                // Lida com a imagem existente ao abrir o modal de edição
                if (funcionalidade.imagem) {
                    const nomeArquivo = funcionalidade.imagem.split('/').pop();
                    if (!imagemExistenteInput) {
                        imagemExistenteInput = document.createElement('input');
                        imagemExistenteInput.type = 'hidden';
                        imagemExistenteInput.name = 'imagem_existente'; // Use o nome do input oculto
                        this.formFuncionalidade.appendChild(imagemExistenteInput);
                    }
                    imagemExistenteInput.value = nomeArquivo; // Armazena o nome do arquivo existente

                    if (!imagemPreview) {
                        imagemPreview = document.createElement('div');
                        imagemPreview.className = 'imagem-preview';
                        // Insere o preview abaixo do input de arquivo
                        imagemInput.parentNode.insertBefore(imagemPreview, imagemInput.nextSibling);
                    }
                    imagemPreview.innerHTML = `Arquivo atual: <strong>${nomeArquivo}</strong> <button type="button" onclick="UI.removerImagemExistente()">Remover</button>`;
                } else {
                    // Limpa qualquer informação de imagem existente se não houver uma
                    if (imagemExistenteInput) {
                        imagemExistenteInput.value = '';
                    }
                    if (imagemPreview) {
                        imagemPreview.remove();
                    }
                }
                // Limpa o input de arquivo para que o usuário precise explicitamente selecionar um novo
                imagemInput.value = '';

                this.modalCadastro.classList.remove('hidden');
            },

            removerImagemExistente: function () {
                const imagemExistenteInput = this.formFuncionalidade.querySelector('[name="imagem_existente"]');
                if (imagemExistenteInput) {
                    imagemExistenteInput.value = ''; // Define o valor como vazio para indicar remoção
                }
                const imagemPreview = this.formFuncionalidade.querySelector('.imagem-preview');
                if (imagemPreview) {
                    imagemPreview.remove(); // Remove o texto de preview
                }
                alert('A imagem será removida ao salvar esta funcionalidade, a menos que você selecione uma nova imagem.');
            },

            // Função para alternar o dropdown de ações
            toggleActionsDropdown: function (event, funcionalidadeId, nomeFuncionalidade) {
                const button = event.currentTarget;
                if (this.currentActionButton === button && !this.actionsDropdown.classList.contains('hidden')) {
                    this.actionsDropdown.classList.add('hidden');
                    this.currentActionButton = null;
                    return;
                }

                this.currentActionButton = button;
                this.actionsDropdown.innerHTML = ''; // Limpa o conteúdo anterior

                const dropdownItems = [
                    { text: 'Visualizar', action: `APIs.carregarDetalhesFuncionalidade(${funcionalidadeId})` },
                    { text: 'Editar', action: `APIs.carregarParaEdicao(${funcionalidadeId})` },
                    { text: 'Excluir', action: `APIs.deletarFuncionalidade(${funcionalidadeId}, '${nomeFuncionalidade}')` }
                ];

                dropdownItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm';
                    div.textContent = item.text;
                    div.onclick = () => {
                        eval(item.action); // Executa a ação
                        this.actionsDropdown.classList.add('hidden'); // Fecha o dropdown
                    };
                    this.actionsDropdown.appendChild(div);
                });

                // Posiciona o dropdown
                const rect = button.getBoundingClientRect();
                this.actionsDropdown.style.top = `${rect.bottom + window.scrollY + 5}px`;
                this.actionsDropdown.style.left = `${rect.left + window.scrollX}px`;
                this.actionsDropdown.classList.remove('hidden');
            },

            fecharActionsDropdown: function () {
                this.actionsDropdown.classList.add('hidden');
                this.currentActionButton = null;
            }
        };

        // Objeto para gerenciar as chamadas de API
        const APIs = {
            API_BASE_URL: "http://localhost:8000", // Certifique-se de que esta URL está correta

            // Função para obter os headers de autenticação
            getAuthHeaders: function () {
                const token = localStorage.getItem('access_token');
                const tokenType = localStorage.getItem('token_type');
                if (token && tokenType) {
                    return {
                        'Authorization': `${tokenType} ${token}`
                    };
                }
                window.location.href = 'index.html';
                throw new Error("Token de autenticação não encontrado. Redirecionando para o login.");
            },


            listarFuncionalidades: async function () {
                try {
                    const headers = this.getAuthHeaders();
                    delete headers['Content-Type']; // GET request, não precisa de Content-Type

                    const response = await fetch(`${this.API_BASE_URL}/funcionalidades`, {
                        method: 'GET',
                        headers: headers
                    });
                    if (!response.ok) {
                        if (response.status === 401) {
                            alert('Sessão expirada ou não autorizada. Por favor, faça login novamente.');
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('token_type');
                            window.location.href = 'index.html';
                            return [];
                        }
                        throw new Error(`Erro ao listar funcionalidades: ${response.statusText}`);
                    }
                    const funcionalidades = await response.json();
                    UI.tabela.innerHTML = ''; // Limpa a tabela antes de popular
                    funcionalidades.forEach(funcionalidade => {
                        const row = UI.tabela.insertRow();
                        row.innerHTML = `
                            <td class="p-3 text-center">
                                <input type="checkbox" class="h-4 w-4 text-[#0D2B45] item-checkbox">
                            </td>
                            <td class="p-3">Projeto X</td>
                            <td class="p-3">${funcionalidade.nome}</td>
                            <td class="p-3">${funcionalidade.prioridade}</td>
                            <td class="p-3">${funcionalidade.relator}</td>
                            <td class="p-3 text-center relative">
                                <button onclick="UI.toggleActionsDropdown(event, ${funcionalidade.id}, '${funcionalidade.nome}')" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                                    </svg>
                                </button>
                            </td>
                        `;
                    });
                    return funcionalidades;
                } catch (error) {
                    console.error("Erro ao listar funcionalidades:", error);
                    return [];
                }
            },

            salvarFuncionalidade: async function (event) {
                event.preventDefault();
                const form = event.target;
                const formData = new FormData(form);
                const funcionalidadeId = form.querySelector('[name="id"]').value;

                // Lógica para manipulação de imagem (mantida)
                const imagemInput = form.querySelector('[name="imagem"]');
                const imagemExistenteInput = form.querySelector('[name="imagem_existente"]');
                if (imagemInput.files.length === 0 && imagemExistenteInput && imagemExistenteInput.value) {
                    formData.append('imagem_mantida', imagemExistenteInput.value);
                    formData.delete('imagem');
                } else if (imagemInput.files.length > 0) {
                    formData.delete('imagem_mantida');
                } else {
                    formData.append('remover_imagem', 'true');
                    formData.delete('imagem');
                    formData.delete('imagem_mantida');
                }

                let method = 'POST';
                let url = `${this.API_BASE_URL}/funcionalidades`;
                if (funcionalidadeId) {
                    method = 'PUT';
                    url = `${this.API_BASE_URL}/funcionalidades/${funcionalidadeId}`;
                }

                const headers = this.getAuthHeaders(); // Chama a função para obter os headers

                // Para FormData, o Content-Type é definido automaticamente como multipart/form-data.
                // Se getAuthHeaders() não adicionar Content-Type, não precisamos deletar aqui.
                // Se precisar, descomente:
                // delete headers['Content-Type'];


                try {
                    const response = await fetch(url, {
                        method: method,
                        headers: headers, // Apenas os headers de autorização
                        body: formData // O FormData que inclui os arquivos
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            alert('Sessão expirada ou não autorizada. Por favor, faça login novamente.');
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('token_type');
                            window.location.href = 'index.html';
                            return;
                        }
                        const errorData = await response.json();
                        throw new Error(`Erro ao salvar funcionalidade: ${errorData.detail || response.statusText}`);
                    }
                    UI.fecharModalCadastro();
                    await this.listarFuncionalidades(); // Recarrega a lista
                    alert(`Funcionalidade ${funcionalidadeId ? 'atualizada' : 'cadastrada'} com sucesso!`); // Feedback ao usuário
                } catch (error) {
                    console.error("Erro ao salvar funcionalidade:", error);
                    alert("Erro ao salvar funcionalidade: " + error.message);
                }
            },
            // ALTERADO: Agora redireciona para a nova tela de detalhes
            carregarDetalhesFuncionalidade: async function (id) {
                // Redireciona para a nova página de detalhes, passando o ID na URL
                window.location.href = `detalhe_funcionalidade.html?id=${id}`;
            },

            carregarParaEdicao: async function (id) {
                try {
                    const headers = this.getAuthHeaders();
                    delete headers['Content-Type']; // GET request, não precisa de Content-Type
                    const response = await fetch(`${this.API_BASE_URL}/funcionalidades/${id}`, { // Alterado para buscar por ID
                        method: 'GET',
                        headers: headers
                    });
                    if (!response.ok) {
                        if (response.status === 401) {
                            alert('Sessão expirada ou não autorizada. Por favor, faça login novamente.');
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('token_type');
                            window.location.href = 'index.html';
                            return;
                        }
                        throw new Error(`Erro ao carregar funcionalidade para edição: ${response.statusText}`);
                    }
                    const funcionalidade = await response.json(); // Espera um único objeto, não uma lista
                    if (funcionalidade) {
                        UI.abrirModalEdicao(funcionalidade);
                    } else {
                        alert("Funcionalidade não encontrada para edição.");
                    }
                } catch (error) {
                    console.error("Erro ao carregar funcionalidade para edição:", error);
                    alert("Erro ao carregar funcionalidade: " + error.message);
                }
            },

            deletarFuncionalidade: async function (id, nomeFuncionalidade) {
                if (!confirm(`Tem certeza que deseja deletar a funcionalidade "${nomeFuncionalidade}"?`)) {
                    return;
                }
                try {
                    const headers = this.getAuthHeaders();
                    const response = await fetch(`${this.API_BASE_URL}/funcionalidades/${id}`, {
                        method: 'DELETE',
                        headers: headers
                    });
                    if (!response.ok) {
                        if (response.status === 401) {
                            alert('Sessão expirada ou não autorizada. Por favor, faça login novamente.');
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('token_type');
                            window.location.href = 'index.html';
                            return;
                        }
                        const errorData = await response.json();
                        throw new Error(`Erro ao deletar funcionalidade: ${errorData.detail || response.statusText}`);
                    }
                    await this.listarFuncionalidades(); // Recarrega a lista
                    alert(`Funcionalidade "${nomeFuncionalidade}" deletada com sucesso!`);
                } catch (error) {
                    console.error("Erro ao deletar funcionalidade:", error);
                    alert("Erro ao deletar funcionalidade: " + error.message);
                }
            },
        };

        // Adiciona o listener para o formulário de funcionalidade
        document.addEventListener('DOMContentLoaded', () => {
            if (checkAuthentication()) {
                APIs.listarFuncionalidades();
                UI.formFuncionalidade.addEventListener('submit', function (event) {
                    APIs.salvarFuncionalidade.call(APIs, event); // Chama salvarFuncionalidade com o contexto de APIs
                });

                // Fechar dropdown de ações ao clicar fora
                document.addEventListener('click', function (event) {
                    if (UI.currentActionButton && !UI.currentActionButton.contains(event.target) && !UI.actionsDropdown.contains(event.target)) {
                        UI.fecharActionsDropdown();
                    }
                });
            }
        });

        // Lógica do checkbox "Selecionar Todos"
        UI.selectAllCheckbox.addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    </script>
</body>

</html>